<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>接口自动化测试平台</title>
    <link rel="stylesheet" href="/static/bootstrap-3.3.7/css/bootstrap.css">
    <link rel="stylesheet" href="/static/css/toastr.min.css">
    <script src="/static/js/jquery-3.3.1.js"></script>
    <script src="/static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script src="/static/js/toastr.min.js"></script>
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <link rel="stylesheet" href="/static/css/home.css">
    <script src="/static/js/sweetalert.min.js"></script>
    <link rel="stylesheet" href="/static/css/sweetalert.css">
    <script src="/static/js/init_ajax.js"></script>

    <style>
        #user_icon {
            font-size: 18px;
            margin-right: 10px;
            vertical-align: -3px;
        }

    </style>
</head>

<body>
<nav class="tab navbar  navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">接口自动化测试平台</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

            <ul class="nav navbar-nav navbar-right">


                <li><a href="#"><span id="user_icon"
                                      class="glyphicon glyphicon-user"></span>{{ request.user.username }}</a></li>
                <li><a href="/logout/">注销</a></li>
                <li><a href="/set_pwd/">修改密码</a></li>


            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>
<div class="container">
    <div class="left">
        <div class="row">
            <div class="col-sm-3 col-md-1 sidebar">
                <div class="menu">
                    <div class="head bg-primary">基础信息</div>
                    <ul class="nav nav-sidebar">
                        <li><a href="/project/" target="_self">测试项目</a> </li>
                        <li><a href="/env/" target="_self">测试环境</a> </li>
                        <li><a href="/interface/" target="_self">测试接口</a> </li>
                        <li><a href="#">测试用例</a> </li>
                        <li><a href="#">测试计划</a> </li>

                    </ul>
                </div>

                <div class="menu">
                    <div class="head bg-primary">系统设置</div>
                    <ul class="nav nav-sidebar">
                        <li><a href="/sign/">签名方式</a> </li>

                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="right">

        {#表格#}
        {% block add %}
            <h1>欢迎csfsdfsdsdsdsdsdsdsdsdsdsdsdsdsdsdsdsdsdes</h1>
        {% endblock %}
    </div>
</div>

<script src="/static/js/jquery-3.3.1.js"></script>
<script src="/static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
<script>
    // 左侧菜单
    $(".head").on("click",function(){
        //兄弟标签紧挨着的ul标签隐藏addclass("hide")
        $(this).parent().siblings().children("ul").slideUp();
        //把自己紧挨着的ul标签显示removeClass("hide")
            $(this).next().removeClass("hide");
        $(this).next().slideToggle();
    });
</script>

<script>

        toastr.options= {
                "closeButton":false,//显示关闭按钮
                "debug":false,//启用debug
                "positionClass":"toast-top-center",//弹出的位置
                "showDuration":"300",//显示的时间
                "hideDuration":"1000",//消失的时间
                "timeOut":"5000",//停留的时间
                "extendedTimeOut":"1000",//控制时间
                "showEasing":"swing",//显示时的动画缓冲方式
                "hideEasing":"linear",//消失时的动画缓冲方式
                "showMethod":"fadeIn",//显示时的动画方式
                "hideMethod":"fadeOut"//消失时的动画方式
                };

        // 新建项目验证

    $(".btn_sub").click(function () {

        $.ajax({
            url: "/add_project/",
            type: "post",
            data: {
                prj_name: $("#prj_name").val(),
                prj_desc: $("#prj_desc").val(),
                testers: $("#testers").val(),
                sign_id: $("#sign_id").val(),
                csrfmiddlewaretoken: $("[name='csrfmiddlewaretoken']").val(),
            },
            success: function (data) {

                if (data.status== 0) {
                    // alert(111)
                    toastr.success(data.msg);
                    if (location.search){
                            location.href = location.search.slice(6)
                    }
                    else {
                        setTimeout(function () {
                            location.href = "/project/"
                        }, 2000)

                    }

                }
                else {


                    $(".error").text(data.msg);
                    setTimeout(function () {
                        $(".error").text("");

                    }, 5000)
                }



            }

        })
    });



    // 新增签名方式

    $(".add_sign").click(function () {

        $.ajax({
            url: "/add_sign/",
            type: "post",
            data: {
                sign_name: $("#sign_name").val(),
                description: $("#description").val(),

                csrfmiddlewaretoken: $("[name='csrfmiddlewaretoken']").val(),
            },
            success: function (data) {

                if (data.status== 0) {
                    // alert(111)
                    toastr.success(data.msg);
                    if (location.search){
                            location.href = location.search.slice(6)
                    }
                    else {
                        setTimeout(function () {
                            location.href = "/sign/"
                        }, 2000)

                    }

                }
                else {


                    $(".error").text(data.msg);
                    setTimeout(function () {
                        $(".error").text("");

                    }, 5000)
                }



            }

        })
    });

    // 删除项目
    $(".btn_delete").click(function () {
            var delete_id = $(this).parent().siblings('td').eq(1).text();
            var row = $(this).parent().parent();
            var pathname = window.location.pathname;
            var url = null;
            alert(delete_id)
            if(pathname.indexOf("project/")>0){
                url = /project/+delete_id+pathname.replace('/project/', '/delete/')
            }


            // 删除插件的应用
            swal({

                title: "确定要删除吗？",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                confirmButtonText: "确定",
                cancelButtonText: "取消",
                closeOnConfirm: true

            },

            function () {
                $.ajax({

                    url: url,
                    type: 'post',
                    data:{
                        delete_id: delete_id,

                    },

                    success:function (ret) {
                        var data = JSON.parse(ret);
                        if(data.status == 0){
                            row.remove();

                            toastr.success(data.msg);
                        }else{
                            toastr.error(data.msg);
                        }


                    }
                });

            });

        });


</script>
</body>
</html>